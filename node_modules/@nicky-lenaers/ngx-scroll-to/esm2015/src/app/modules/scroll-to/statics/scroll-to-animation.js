/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { ReplaySubject } from 'rxjs/index';
import { EASING } from '../statics/scroll-to-helpers';
/**
 * Scroll To Animation.
 */
export class ScrollToAnimation {
    /**
     * Class Constructor.
     *
     * @param {?} _container            The Container
     * @param {?} _listenerTarget       The Element that listens for DOM Events
     * @param {?} _isWindow             Whether or not the listener is the Window
     * @param {?} _to                   Position to scroll to
     * @param {?} _options              Additional options for scrolling
     * @param {?} _isBrowser            Whether or not execution runs in the browser
     *                              (as opposed to the server)
     */
    constructor(_container, _listenerTarget, _isWindow, _to, _options, _isBrowser) {
        this._container = _container;
        this._listenerTarget = _listenerTarget;
        this._isWindow = _isWindow;
        this._to = _to;
        this._options = _options;
        this._isBrowser = _isBrowser;
        /**
         * Recursively loop over the Scroll Animation.
         *
         * @return Void
         */
        this._loop = () => {
            this._timeLapsed += this._tick;
            this._percentage = (this._timeLapsed / this._options.duration);
            this._percentage = (this._percentage > 1) ? 1 : this._percentage;
            // Position Update
            this._position = this._startPosition +
                ((this._startPosition - this._to <= 0 ? 1 : -1) *
                    this._distance *
                    EASING[this._options.easing](this._percentage));
            if (this._lastPosition !== null && this._position === this._lastPosition) {
                this.stop();
            }
            else {
                this._source$.next(this._position);
                this._isWindow
                    ? this._listenerTarget.scrollTo(0, Math.floor(this._position))
                    : this._container.scrollTop = Math.floor(this._position);
                this._lastPosition = this._position;
            }
        };
        this._tick = 16;
        this._interval = null;
        this._lastPosition = null;
        this._timeLapsed = 0;
        this._windowScrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
        if (!this._container) {
            this._startPosition = this._windowScrollTop;
        }
        else {
            this._startPosition = this._isWindow ? this._windowScrollTop : this._container.scrollTop;
        }
        // Correction for Starting Position of nested HTML Elements
        if (this._container && !this._isWindow) {
            this._to = this._to - this._container.getBoundingClientRect().top + this._startPosition;
        }
        // Set Distance
        const /** @type {?} */ directionalDistance = this._startPosition - this._to;
        this._distance = this._container ? Math.abs(this._startPosition - this._to) : this._to;
        this._mappedOffset = this._options.offset;
        // Set offset from Offset Map
        if (this._isBrowser) {
            this._options
                .offsetMap
                .forEach((value, key) => this._mappedOffset = window.innerWidth > key ? value : this._mappedOffset);
        }
        this._distance += this._mappedOffset * (directionalDistance <= 0 ? 1 : -1);
        this._source$ = new ReplaySubject();
    }
    /**
     * Start the new Scroll Animation.
     *
     * @return {?} Observable containing a number
     */
    start() {
        clearInterval(this._interval);
        this._interval = setInterval(this._loop, this._tick);
        return this._source$.asObservable();
    }
    /**
     * Stop the current Scroll Animation Loop.
     *
     * @return {?} Void
     */
    stop() {
        clearInterval(this._interval);
        this._interval = null;
        this._source$.complete();
    }
}
function ScrollToAnimation_tsickle_Closure_declarations() {
    /**
     * Number of milliseconds for each Tick.
     * @type {?}
     */
    ScrollToAnimation.prototype._tick;
    /**
     * JavaScript Interval.
     * @type {?}
     */
    ScrollToAnimation.prototype._interval;
    /**
     * Time Lapsed in milliseconds.
     * @type {?}
     */
    ScrollToAnimation.prototype._timeLapsed;
    /**
     * Percentage of time lapsed.
     * @type {?}
     */
    ScrollToAnimation.prototype._percentage;
    /**
     * Position of the Element.
     * @type {?}
     */
    ScrollToAnimation.prototype._position;
    /**
     * Last Position.
     * @type {?}
     */
    ScrollToAnimation.prototype._lastPosition;
    /**
     * Start Position of the Element.
     * @type {?}
     */
    ScrollToAnimation.prototype._startPosition;
    /**
     * The Distance to scroll.
     * @type {?}
     */
    ScrollToAnimation.prototype._distance;
    /**
     * Observable Source.
     * @type {?}
     */
    ScrollToAnimation.prototype._source$;
    /**
     * Scroll Top of the Window.
     * @type {?}
     */
    ScrollToAnimation.prototype._windowScrollTop;
    /**
     * Mapped Offset taken from the active Offset Map.
     * @type {?}
     */
    ScrollToAnimation.prototype._mappedOffset;
    /**
     * Recursively loop over the Scroll Animation.
     *
     * \@return Void
     * @type {?}
     */
    ScrollToAnimation.prototype._loop;
    /** @type {?} */
    ScrollToAnimation.prototype._container;
    /** @type {?} */
    ScrollToAnimation.prototype._listenerTarget;
    /** @type {?} */
    ScrollToAnimation.prototype._isWindow;
    /** @type {?} */
    ScrollToAnimation.prototype._to;
    /** @type {?} */
    ScrollToAnimation.prototype._options;
    /** @type {?} */
    ScrollToAnimation.prototype._isBrowser;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2Nyb2xsLXRvLWFuaW1hdGlvbi5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BuaWNreS1sZW5hZXJzL25neC1zY3JvbGwtdG8vIiwic291cmNlcyI6WyJzcmMvYXBwL21vZHVsZXMvc2Nyb2xsLXRvL3N0YXRpY3Mvc2Nyb2xsLXRvLWFuaW1hdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFjLGFBQWEsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUV2RCxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sOEJBQThCLENBQUM7Ozs7QUFTdEQsTUFBTTs7Ozs7Ozs7Ozs7O0lBb0VKLFlBQ1UsWUFDQSxpQkFDUyxXQUNBLEtBQ0EsVUFDVDtRQUxBLGVBQVUsR0FBVixVQUFVO1FBQ1Ysb0JBQWUsR0FBZixlQUFlO1FBQ04sY0FBUyxHQUFULFNBQVM7UUFDVCxRQUFHLEdBQUgsR0FBRztRQUNILGFBQVEsR0FBUixRQUFRO1FBQ2pCLGVBQVUsR0FBVixVQUFVOzs7Ozs7cUJBcURKLEdBQVMsRUFBRTtZQUV6QixJQUFJLENBQUMsV0FBVyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUM7WUFDL0IsSUFBSSxDQUFDLFdBQVcsR0FBRyxDQUFDLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUMvRCxJQUFJLENBQUMsV0FBVyxHQUFHLENBQUMsSUFBSSxDQUFDLFdBQVcsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDOztZQUdqRSxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxjQUFjO2dCQUNsQyxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDN0MsSUFBSSxDQUFD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U0FDdkc7UUFFRCxJQUFJLENBQUMsU0FBUyxJQUFJLElBQUksQ0FBQyxhQUFhLEdBQUcsQ0FBQyxtQkFBbUIsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMzRSxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksYUFBYSxFQUFFLENBQUM7S0FDckM7Ozs7OztJQU9NLEtBQUs7UUFDVixhQUFhLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQzlCLElBQUksQ0FBQyxTQUFTLEdBQUcsV0FBVyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3JELE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFlBQVksRUFBRSxDQUFDOzs7Ozs7O0lBcUMvQixJQUFJO1FBQ1QsYUFBYSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUM5QixJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztRQUN0QixJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDOztDQUU1QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9ic2VydmFibGUsIFJlcGxheVN1YmplY3QgfSBmcm9tICdyeGpzL2luZGV4JztcclxuXHJcbmltcG9ydCB7IEVBU0lORyB9IGZyb20gJy4uL3N0YXRpY3Mvc2Nyb2xsLXRvLWhlbHBlcnMnO1xyXG5pbXBvcnQge1xyXG4gIFNjcm9sbFRvQ29uZmlnT3B0aW9ucyxcclxuICBTY3JvbGxUb0xpc3RlbmVyVGFyZ2V0XHJcbn0gZnJvbSAnLi4vbW9kZWxzL3Njcm9sbC10by1jb25maWcubW9kZWwnO1xyXG5cclxuLyoqXHJcbiAqIFNjcm9sbCBUbyBBbmltYXRpb24uXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgU2Nyb2xsVG9BbmltYXRpb24ge1xyXG5cclxuICAvKipcclxuICAgKiBOdW1iZXIgb2YgbWlsbGlzZWNvbmRzIGZvciBlYWNoIFRpY2suXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBfdGljazogbnVtYmVyO1xyXG5cclxuICAvKipcclxuICAgKiBKYXZhU2NyaXB0IEludGVydmFsLlxyXG4gICAqL1xyXG4gIHByaXZhdGUgX2ludGVydmFsOiBhbnk7XHJcblxyXG4gIC8qKlxyXG4gICAqIFRpbWUgTGFwc2VkIGluIG1pbGxpc2Vjb25kcy5cclxuICAgKi9cclxuICBwcml2YXRlIF90aW1lTGFwc2VkOiBudW1iZXI7XHJcblxyXG4gIC8qKlxyXG4gICAqIFBlcmNlbnRhZ2Ugb2YgdGltZSBsYXBzZWQuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBfcGVyY2VudGFnZTogbnVtYmVyO1xyXG5cclxuICAvKipcclxuICAgKiBQb3NpdGlvbiBvZiB0aGUgRWxlbWVudC5cclxuICAgKi9cclxuICBwcml2YXRlIF9wb3NpdGlvbjogbnVtYmVyO1xyXG5cclxuICAvKipcclxuICAgKiBMYXN0IFBvc2l0aW9uLlxyXG4gICAqL1xyXG4gIHByaXZhdGUgX2xhc3RQb3NpdGlvbjogbnVtYmVyO1xyXG5cclxuICAvKipcclxuICAgKiBTdGFydCBQb3NpdGlvbiBvZiB0aGUgRWxlbWVudC5cclxuICAgKi9cclxuICBwcml2YXRlIF9zdGFydFBvc2l0aW9uOiBudW1iZXI7XHJcblxyXG4gIC8qKlxyXG4gICAqIFRoZSBEaXN0YW5jZSB0byBzY3JvbGwuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBfZGlzdGFuY2U6IG51bWJlcjtcclxuXHJcbiAgLyoqXHJcbiAgICogT2JzZXJ2YWJsZSBTb3VyY2UuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBfc291cmNlJDogUmVwbGF5U3ViamVjdDxudW1iZXI+O1xyXG5cclxuICAvKipcclxuICAgKiBTY3JvbGwgVG9wIG9mIHRoZSBXaW5kb3cuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBfd2luZG93U2Nyb2xsVG9wOiBudW1iZXI7XHJcblxyXG4gIC8qKlxyXG4gICAqIE1hcHBlZCBPZmZzZXQgdGFrZW4gZnJvbSB0aGUgYWN0aXZlIE9mZnNldCBNYXAuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBfbWFwcGVkT2Zmc2V0OiBudW1iZXI7XHJcblxyXG4gIC8qKlxyXG4gICAqIENsYXNzIENvbnN0cnVjdG9yLlxyXG4gICAqXHJcbiAgICogQHBhcmFtIF9jb250YWluZXIgICAgICAgICAgICBUaGUgQ29udGFpbmVyXHJcbiAgICogQHBhcmFtIF9saXN0ZW5lclRhcmdldCAgICAgICBUaGUgRWxlbWVudCB0aGF0IGxpc3RlbnMgZm9yIERPTSBFdmVudHNcclxuICAgKiBAcGFyYW0gX2lzV2luZG93ICAgICAgICAgICAgIFdoZXRoZXIgb3Igbm90IHRoZSBsaXN0ZW5lciBpcyB0aGUgV2luZG93XHJcbiAgICogQHBhcmFtIF90byAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiB0byBzY3JvbGwgdG9cclxuICAgKiBAcGFyYW0gX29wdGlvbnMgICAgICAgICAgICAgIEFkZGl0aW9uYWwgb3B0aW9ucyBmb3Igc2Nyb2xsaW5nXHJcbiAgICogQHBhcmFtIF9pc0Jyb3dzZXIgICAgICAgICAgICBXaGV0aGVyIG9yIG5vdCBleGVjdXRpb24gcnVucyBpbiB0aGUgYnJvd3NlclxyXG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGFzIG9wcG9zZWQgdG8gdGhlIHNlcnZlcilcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgX2NvbnRhaW5lcjogSFRNTEVsZW1lbnQsXHJcbiAgICBwcml2YXRlIF9saXN0ZW5lclRhcmdldDogU2Nyb2xsVG9MaXN0ZW5lclRhcmdldCxcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgX2lzV2luZG93OiBib29sZWFuLFxyXG4gICAgcHJpdmF0ZSByZWFkb25seSBfdG86IG51bWJlcixcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgX29wdGlvbnM6IFNjcm9sbFRvQ29uZmlnT3B0aW9ucyxcclxuICAgIHByaXZhdGUgX2lzQnJvd3NlcjogYm9vbGVhblxyXG4gICkge1xyXG4gICAgdGhpcy5fdGljayA9IDE2O1xyXG4gICAgdGhpcy5faW50ZXJ2YWwgPSBudWxsO1xyXG4gICAgdGhpcy5fbGFzdFBvc2l0aW9uID0gbnVsbDtcclxuICAgIHRoaXMuX3RpbWVMYXBzZWQgPSAwO1xyXG5cclxuICAgIHRoaXMuX3dpbmRvd1Njcm9sbFRvcCA9IHdpbmRvdy5wYWdlWU9mZnNldCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wIHx8IGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wIHx8IDA7XHJcblxyXG4gICAgaWYgKCF0aGlzLl9jb250YWluZXIpIHtcclxuICAgICAgdGhpcy5fc3RhcnRQb3NpdGlvbiA9IHRoaXMuX3dpbmRvd1Njcm9sbFRvcDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX3N0YXJ0UG9zaXRpb24gPSB0aGlzLl9pc1dpbmRvdyA/IHRoaXMuX3dpbmRvd1Njcm9sbFRvcCA6IHRoaXMuX2NvbnRhaW5lci5zY3JvbGxUb3A7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ29ycmVjdGlvbiBmb3IgU3RhcnRpbmcgUG9zaXRpb24gb2YgbmVzdGVkIEhUTUwgRWxlbWVudHNcclxuICAgIGlmICh0aGlzLl9jb250YWluZXIgJiYgIXRoaXMuX2lzV2luZG93KSB7XHJcbiAgICAgIHRoaXMuX3RvID0gdGhpcy5fdG8gLSB0aGlzLl9jb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wICsgdGhpcy5fc3RhcnRQb3NpdGlvbjtcclxuICAgIH1cclxuXHJcbiAgICAvLyBTZXQgRGlzdGFuY2VcclxuICAgIGNvbnN0IGRpcmVjdGlvbmFsRGlzdGFuY2UgPSB0aGlzLl9zdGFydFBvc2l0aW9uIC0gdGhpcy5fdG87XHJcbiAgICB0aGlzLl9kaXN0YW5jZSA9IHRoaXMuX2NvbnRhaW5lciA/IE1hdGguYWJzKHRoaXMuX3N0YXJ0UG9zaXRpb24gLSB0aGlzLl90bykgOiB0aGlzLl90bztcclxuXHJcbiAgICB0aGlzLl9tYXBwZWRPZmZzZXQgPSB0aGlzLl9vcHRpb25zLm9mZnNldDtcclxuXHJcbiAgICAvLyBTZXQgb2Zmc2V0IGZyb20gT2Zmc2V0IE1hcFxyXG4gICAgaWYgKHRoaXMuX2lzQnJvd3Nlcikge1xyXG4gICAgICB0aGlzLl9vcHRpb25zXHJcbiAgICAgICAgLm9mZnNldE1hcFxyXG4gICAgICAgIC5mb3JFYWNoKCh2YWx1ZSwga2V5KSA9PiB0aGlzLl9tYXBwZWRPZmZzZXQgPSB3aW5kb3cuaW5uZXJXaWR0aCA+IGtleSA/IHZhbHVlIDogdGhpcy5fbWFwcGVkT2Zmc2V0KTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLl9kaXN0YW5jZSArPSB0aGlzLl9tYXBwZWRPZmZzZXQgKiAoZGlyZWN0aW9uYWxEaXN0YW5jZSA8PSAwID8gMSA6IC0xKTtcclxuICAgIHRoaXMuX3NvdXJjZSQgPSBuZXcgUmVwbGF5U3ViamVjdCgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RhcnQgdGhlIG5ldyBTY3JvbGwgQW5pbWF0aW9uLlxyXG4gICAqXHJcbiAgICogQHJldHVybnMgICAgICAgICBPYnNlcnZhYmxlIGNvbnRhaW5pbmcgYSBudW1iZXJcclxuICAgKi9cclxuICBwdWJsaWMgc3RhcnQoKTogT2JzZXJ2YWJsZTxudW1iZXI+IHtcclxuICAgIGNsZWFySW50ZXJ2YWwodGhpcy5faW50ZXJ2YWwpO1xyXG4gICAgdGhpcy5faW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCh0aGlzLl9sb29wLCB0aGlzLl90aWNrKTtcclxuICAgIHJldHVybiB0aGlzLl9zb3VyY2UkLmFzT2JzZXJ2YWJsZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVjdXJzaXZlbHkgbG9vcCBvdmVyIHRoZSBTY3JvbGwgQW5pbWF0aW9uLlxyXG4gICAqXHJcbiAgICogQHJldHVybnMgICAgICAgICAgIFZvaWRcclxuICAgKi9cclxuICBwcml2YXRlIF9sb29wID0gKCk6IHZvaWQgPT4ge1xyXG5cclxuICAgIHRoaXMuX3RpbWVMYXBzZWQgKz0gdGhpcy5fdGljaztcclxuICAgIHRoaXMuX3BlcmNlbnRhZ2UgPSAodGhpcy5fdGltZUxhcHNlZCAvIHRoaXMuX29wdGlvbnMuZHVyYXRpb24pO1xyXG4gICAgdGhpcy5fcGVyY2VudGFnZSA9ICh0aGlzLl9wZXJjZW50YWdlID4gMSkgPyAxIDogdGhpcy5fcGVyY2VudGFnZTtcclxuXHJcbiAgICAvLyBQb3NpdGlvbiBVcGRhdGVcclxuICAgIHRoaXMuX3Bvc2l0aW9uID0gdGhpcy5fc3RhcnRQb3NpdGlvbiArXHJcbiAgICAgICgodGhpcy5fc3RhcnRQb3NpdGlvbiAtIHRoaXMuX3RvIDw9IDAgPyAxIDogLTEpICpcclxuICAgICAgICB0aGlzLl9kaXN0YW5jZSAqXHJcbiAgICAgICAgRUFTSU5HW3RoaXMuX29wdGlvbnMuZWFzaW5nXSh0aGlzLl9wZXJjZW50YWdlKSk7XHJcblxyXG4gICAgaWYgKHRoaXMuX2xhc3RQb3NpdGlvbiAhPT0gbnVsbCAmJiB0aGlzLl9wb3NpdGlvbiA9PT0gdGhpcy5fbGFzdFBvc2l0aW9uKSB7XHJcbiAgICAgIHRoaXMuc3RvcCgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5fc291cmNlJC5uZXh0KHRoaXMuX3Bvc2l0aW9uKTtcclxuICAgICAgdGhpcy5faXNXaW5kb3dcclxuICAgICAgICA/IHRoaXMuX2xpc3RlbmVyVGFyZ2V0LnNjcm9sbFRvKDAsIE1hdGguZmxvb3IodGhpcy5fcG9zaXRpb24pKVxyXG4gICAgICAgIDogdGhpcy5fY29udGFpbmVyLnNjcm9sbFRvcCA9IE1hdGguZmxvb3IodGhpcy5fcG9zaXRpb24pO1xyXG4gICAgICB0aGlzLl9sYXN0UG9zaXRpb24gPSB0aGlzLl9wb3NpdGlvbjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFN0b3AgdGhlIGN1cnJlbnQgU2Nyb2xsIEFuaW1hdGlvbiBMb29wLlxyXG4gICAqXHJcbiAgICogQHBhcmFtIGZvcmNlIFx0XHRcdCAgICBGb3JjZSB0byBzdG9wIHRoZSBBbmltYXRpb24gTG9vcFxyXG4gICAqIEByZXR1cm5zICAgICAgICAgICAgICAgVm9pZFxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdG9wKCk6IHZvaWQge1xyXG4gICAgY2xlYXJJbnRlcnZhbCh0aGlzLl9pbnRlcnZhbCk7XHJcbiAgICB0aGlzLl9pbnRlcnZhbCA9IG51bGw7XHJcbiAgICB0aGlzLl9zb3VyY2UkLmNvbXBsZXRlKCk7XHJcbiAgfVxyXG59XHJcbiJdfQ==